// Function to send book issue notification email
async function sendBookIssueEmail(userEmail, userName, bookTitle, bookBarcode, issuedDate, dueDate) {
  try {
    const issueDateTime = new Date(issuedDate).toLocaleString('en-IN', { 
      timeZone: 'Asia/Kolkata',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });

    const dueDateStr = new Date(dueDate).toLocaleDateString('en-IN', {
      timeZone: 'Asia/Kolkata',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    const mailOptions = {
      from: process.env.EMAIL_USER || 'your-email@gmail.com',
      to: userEmail,
      subject: `ğŸ“š Book Issued: ${bookTitle}`,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
            <h1>ğŸ“š Smart Library System</h1>
            <p>Book Issue Confirmation</p>
          </div>
          <div style="padding: 30px; background: white; border-radius: 0 0 10px 10px; border: 1px solid #e0e0e0;">
            <p>Dear <strong>${userName}</strong>,</p>
            <p>Your book has been successfully issued. Here are the details:</p>
            <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
              <p><strong>ğŸ“• Book Title:</strong> ${bookTitle}</p>
              <p><strong>ğŸ“… Issue Date & Time:</strong> ${issueDateTime}</p>
              <p><strong>ğŸ“† Due Date:</strong> ${dueDateStr}</p>
              <p><strong>ğŸ”– Barcode:</strong> ${bookBarcode}</p>
            </div>
            <p style="color: #666;">Please return the book by the due date to avoid any penalties.</p>
            <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 20px 0;">
            <p style="color: #999; font-size: 12px; text-align: center;">Smart Library System Â© 2025</p>
          </div>
        </div>
      `
    };

    await transporter.sendMail(mailOptions);
    console.log('ğŸ“§ Book issue email sent to:', userEmail);
    return true;
  } catch (error) {
    console.error('âŒ Error sending book issue email:', error);
    return false;
  }
}

// Function to send book return notification email
async function sendBookReturnEmail(userEmail, userName, bookTitle, bookBarcode, returnDate) {
  try {
    const returnDateTime = new Date(returnDate).toLocaleString('en-IN', { 
      timeZone: 'Asia/Kolkata',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });

    const mailOptions = {
      from: process.env.EMAIL_USER || 'your-email@gmail.com',
      to: userEmail,
      subject: `ğŸ“š Book Returned: ${bookTitle}`,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
            <h1>ğŸ“š Smart Library System</h1>
            <p>Book Return Confirmation</p>
          </div>
          <div style="padding: 30px; background: white; border-radius: 0 0 10px 10px; border: 1px solid #e0e0e0;">
            <p>Dear <strong>${userName}</strong>,</p>
            <p>Thank you for returning your book. Here are the details:</p>
            <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #10b981;">
              <p><strong>ğŸ“• Book Title:</strong> ${bookTitle}</p>
              <p><strong>ğŸ“… Return Date & Time:</strong> ${returnDateTime}</p>
              <p><strong>ğŸ”– Barcode:</strong> ${bookBarcode}</p>
              <p style="color: #10b981; margin-top: 15px;">âœ… <strong>Status:</strong> Successfully Returned</p>
            </div>
            <p style="color: #666;">Thank you for using our library services!</p>
            <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 20px 0;">
            <p style="color: #999; font-size: 12px; text-align: center;">Smart Library System Â© 2025</p>
          </div>
        </div>
      `
    };

    await transporter.sendMail(mailOptions);
    console.log('ğŸ“§ Book return email sent to:', userEmail);
    return true;
  } catch (error) {
    console.error('âŒ Error sending book return email:', error);
    return false;
  }
}

// Function to send book reissue notification email
async function sendBookReissueEmail(userEmail, userName, bookTitle, bookBarcode, reissueDate, newDueDate) {
  try {
    const reissueDateTime = new Date(reissueDate).toLocaleString('en-IN', { 
      timeZone: 'Asia/Kolkata',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });

    const newDueDateStr = new Date(newDueDate).toLocaleDateString('en-IN', {
      timeZone: 'Asia/Kolkata',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    const mailOptions = {
      from: process.env.EMAIL_USER || 'your-email@gmail.com',
      to: userEmail,
      subject: `ğŸ“š Book Reissued: ${bookTitle}`,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
            <h1>ğŸ“š Smart Library System</h1>
            <p>Book Reissue Confirmation</p>
          </div>
          <div style="padding: 30px; background: white; border-radius: 0 0 10px 10px; border: 1px solid #e0e0e0;">
            <p>Dear <strong>${userName}</strong>,</p>
            <p>Your book has been successfully reissued with an extended due date:</p>
            <div style="background: #fffbeb; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #f59e0b;">
              <p><strong>ğŸ“• Book Title:</strong> ${bookTitle}</p>
              <p><strong>ğŸ“… Reissue Date & Time:</strong> ${reissueDateTime}</p>
              <p><strong>ğŸ“† New Due Date:</strong> ${newDueDateStr}</p>
              <p><strong>ğŸ”– Barcode:</strong> ${bookBarcode}</p>
              <p style="color: #f59e0b; margin-top: 15px;">ğŸ”„ <strong>Status:</strong> Extended by 7 days</p>
            </div>
            <p style="color: #666;">Please return the book by the new due date.</p>
            <hr style="border: none; border-top: 1px solid #e0e0e0; margin: 20px 0;">
            <p style="color: #999; font-size: 12px; text-align: center;">Smart Library System Â© 2025</p>
          </div>
        </div>
      `
    };

    await transporter.sendMail(mailOptions);
    console.log('ğŸ“§ Book reissue email sent to:', userEmail);
    return true;
  } catch (error) {
    console.error('âŒ Error sending book reissue email:', error);
    return false;
  }
}
